@page "/"
@using Grpc.Net.Client
@using Google.Protobuf.WellKnownTypes;
@using BlazorWasmGrpcBlog.Client.Helpers
@using BlazorWasmGrpcBlog.Shared.Protos
@inject GrpcChannel Channel

<h1>Blog Posts</h1>

@if (postsLst == null)
{
    <p>Loading ...</p>
}
else
{
    foreach (var post in postsLst)
    {
        <p>@DtUtils.DbUtc2Local(post.DateCreated) - @post.Title by @post.PostAuthor.Name - @DtUtils.ProtoTs2Utc(post.PostExt.Ts)</p>
    }
}

@code {
    private BlogProto.BlogProtoClient client;
    private List<Post> postsLst;

    protected override async Task OnInitializedAsync()
    {
        client = new BlogProto.BlogProtoClient(Channel);
        postsLst = (await client.GetPostsAsync(new Empty())).PostsData.ToList();
    }
}
