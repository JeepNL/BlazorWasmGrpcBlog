syntax = "proto3";
option csharp_namespace = "BlazorWasmGrpcBlog.Shared.Protos";
import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";
package blogproto;

service BlogProto{
	rpc GetPosts(google.protobuf.Empty) returns (Posts);
	rpc GetPost(GetPostQuery) returns (Post);
	rpc GetAuthors(google.protobuf.Empty) returns (Authors);
	rpc GetAuthorPosts(GetAuthorPostsQuery) returns (Posts);
	rpc GetAuthor(GetAuthorQuery) returns (Author);
}

message Author {
	int32 id = 1;
	string name = 2;
	string date_created = 3; // DateTime (UTC)
}
message Authors {
	repeated Author authors_data = 1;
}

message Post { // For Public Access
	int32 id = 1;
	int32 author_id = 2;
	string title = 3;
	string content = 4;
	string date_created = 5; // DateTime (UTC)
	PostStatus post_status = 6; // enum
	PostExtended post_extended = 7; // one to one
	Author author = 8; // one to one
	repeated Tag tags = 9; // Post with many Tags
}
message Posts {
	repeated Post posts_data = 1;
}

message PostExtended { // Extra Post Info For Authorized (Roles) Access  i.e. Moderators/Admins
	int32 post_id = 1; // Same key as Post, see ApplicationsDbContext.cs -> modelBuilder.Entity<PostExtended>() -> HasKey & ValueGeneratedNever
	google.protobuf.Timestamp Ts = 2; // See tsConverter in ApplicationsDbContext.cs
	// etc. etc.
}

enum PostStatus {
	POST_STATUS_HIDDEN = 0; // Default, must be 0.
	POST_STATUS_PUBLISHED = 1;
	POST_STATUS_DELETED = 2;
}

/*
	TODO: Many to Many Tag in auto generated table "PostTag"

	Because of "message Post" with "repeated Tag tags"
	and "message Tag" with "repeated Post posts"
	EF Core creates "PostTag" table 'automagically'.
*/

message Tag {
	string id = 1; // Tag itself: string
	repeated Post posts = 2; // Tag with many Posts
}
message Tags {
	repeated Tag tags_data = 1;
}

message GetPostQuery {
	int32 id = 1;
}

message GetAuthorQuery {
	int32 id = 1;
}

message GetAuthorPostsQuery {
	int32 id = 1;
}
